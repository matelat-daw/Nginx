<!DOCTYPE html>
<html>
<head>
    <title>Test Password Toggle</title>
    <style>
        .test-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 2rem;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .password-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            margin: 1rem 0;
        }
        .password-input-wrapper input {
            width: 100%;
            padding: 0.8rem;
            padding-right: 2.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }
        .toggle-btn {
            position: absolute;
            right: 0.5rem;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #666;
            padding: 0.25rem;
            z-index: 10;
        }
        .toggle-btn:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>üîç Test de Toggle de Contrase√±a</h2>
        
        <div class="password-input-wrapper">
            <label for="testPassword">Contrase√±a de prueba:</label>
            <input type="password" id="testPassword" value="test123" />
            <button type="button" class="toggle-btn" id="toggleTest" aria-label="Mostrar/ocultar contrase√±a">üëÅÔ∏è</button>
        </div>
        
        <div id="status"></div>
        
        <button onclick="testLogin()">üîê Probar Login Real</button>
    </div>

    <script>
        // Test b√°sico del toggle
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('toggleTest');
            const passwordInput = document.getElementById('testPassword');
            const status = document.getElementById('status');
            
            if (toggleBtn && passwordInput) {
                toggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const currentType = passwordInput.type;
                    const isPassword = currentType === 'password';
                    const newType = isPassword ? 'text' : 'password';
                    
                    console.log('Toggle - Antes:', {
                        type: currentType,
                        value: passwordInput.value,
                        display: getComputedStyle(passwordInput).display
                    });
                    
                    // M√©todo robusto
                    const currentValue = passwordInput.value;
                    const selectionStart = passwordInput.selectionStart;
                    const selectionEnd = passwordInput.selectionEnd;
                    
                    passwordInput.blur();
                    passwordInput.type = newType;
                    
                    // Forzar re-render
                    passwordInput.style.display = 'none';
                    passwordInput.offsetHeight; // Trigger reflow
                    passwordInput.style.display = 'block';
                    
                    passwordInput.value = currentValue;
                    passwordInput.focus();
                    
                    if (selectionStart !== null && selectionEnd !== null) {
                        passwordInput.setSelectionRange(selectionStart, selectionEnd);
                    }
                    
                    toggleBtn.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';
                    
                    console.log('Toggle - Despu√©s:', {
                        type: passwordInput.type,
                        value: passwordInput.value,
                        display: getComputedStyle(passwordInput).display
                    });
                    
                    status.innerHTML = `<p>‚úÖ Toggle: ${currentType} ‚Üí ${newType}<br>Valor: "${passwordInput.value}"</p>`;
                });
                
                status.innerHTML = '<p>‚úÖ Toggle inicializado correctamente</p>';
            } else {
                status.innerHTML = '<p>‚ùå Error: no se encontraron elementos</p>';
            }
        });
        
        // Test de login real
        function testLogin() {
            const email = 'test@test.com';
            const password = document.getElementById('testPassword').value;
            
            document.getElementById('status').innerHTML = `<p>üîÑ Probando login con: ${email} / ${password}</p>`;
            
            fetch('/api/auth/login.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('status').innerHTML = `
                    <h3>Resultado de login:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            })
            .catch(error => {
                document.getElementById('status').innerHTML = `<p>‚ùå Error: ${error.message}</p>`;
            });
        }
    </script>
</body>
</html>
